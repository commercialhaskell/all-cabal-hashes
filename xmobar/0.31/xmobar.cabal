name:               xmobar
version:            0.31
homepage:           http://xmobar.org
synopsis:           A Minimalistic Text Based Status Bar
description: 	    Xmobar is a minimalistic text based status bar.
                    .
                    Inspired by the Ion3 status bar, it supports similar
                    features, like dynamic color management, output templates,
                    and extensibility through plugins.
category:           System
license:            BSD3
license-file:       license
author:             Andrea Rossato and Jose A. Ortega Ruiz
maintainer:         Jose A. Ortega Ruiz <jao@gnu.org>
bug-reports:        https://github.com/jaor/xmobar/issues
cabal-version:      >= 1.8
build-type:         Simple

extra-source-files: readme.md, changelog.md,
                    examples/padding-icon.sh,
                    examples/xmobar.config,
                    examples/xmobar.hs,
                    examples/xmonadpropwrite.hs

source-repository head
  type:      git
  location:  git://github.com/jaor/xmobar.git
  branch:    master

flag with_xft
  description: Use Xft to render text. UTF-8 support included.
  default: False

flag with_utf8
  description: With UTF-8 support.
  default: True

flag with_inotify
  description: inotify support (modern Linux only). Required for the Mail and MBox plugins.
  default: False

flag with_iwlib
  description: Wireless info support. Required for the Wireless plugin, needs iwlib installed.
  default: False

flag with_mpd
  description: MPD support. Needs libmpd installed.
  default: False

flag all_extensions
  description: Includes all optional extensions.
  default: False

flag with_alsa
  description: Use alsa-mixer to get the volume from soundcards.
  default: False

flag with_datezone
  description: Enables localized date support.
  default: False

flag with_mpris
  description: MPRIS v1, v2 support.
  default: False

flag with_dbus
  description: Publish a service on the session bus for controlling xmobar.
  default: False

flag with_xpm
  description: Enable usage of xpm for icons.
  default: False

flag with_threaded
  description: Use threaded runtime.
  default: False

flag with_rtsopts
  description: Use -with-rtsopts=-V0 to reduce wakeups.
  default: True

flag with_uvmeter
  description: UVMeter only useful to australians.
  default: False

flag with_weather
  description: Enable weather plugin.
  default: True

library
    hs-source-dirs:  src

    exposed-modules: Xmobar

    other-modules: Paths_xmobar,
                   Xmobar.Config.Types,
                   Xmobar.Config.Parse,
                   Xmobar.Run.Types,
                   Xmobar.Run.Template,
                   Xmobar.Run.Exec,
                   Xmobar.Run.Command,
                   Xmobar.Run.Runnable
                   Xmobar.App.EventLoop,
                   Xmobar.App.Config,
                   Xmobar.App.Main,
                   Xmobar.App.Opts,
                   Xmobar.App.Compile,
                   Xmobar.System.Utils,
                   Xmobar.System.StatFS,
                   Xmobar.System.Environment,
                   Xmobar.System.Localize,
                   Xmobar.System.Signal,
                   Xmobar.System.Kbd,
                   Xmobar.X11.Actions,
                   Xmobar.X11.Events,
                   Xmobar.X11.Parsers,
                   Xmobar.X11.Types,
                   Xmobar.X11.Text,
                   Xmobar.X11.Bitmap,
                   Xmobar.X11.ColorCache,
                   Xmobar.X11.Window,
                   Xmobar.X11.Draw,
                   Xmobar.Plugins.BufferedPipeReader,
                   Xmobar.Plugins.CommandReader,
                   Xmobar.Plugins.Date,
                   Xmobar.Plugins.EWMH,
                   Xmobar.Plugins.PipeReader,
                   Xmobar.Plugins.MarqueePipeReader,
                   Xmobar.Plugins.StdinReader,
                   Xmobar.Plugins.XMonadLog,
                   Xmobar.Plugins.Kbd,
                   Xmobar.Plugins.Locks,
                   Xmobar.Plugins.Monitors,
                   Xmobar.Plugins.Monitors.Batt,
                   Xmobar.Plugins.Monitors.Common,
                   Xmobar.Plugins.Monitors.Common.Types,
                   Xmobar.Plugins.Monitors.Common.Run,
                   Xmobar.Plugins.Monitors.Common.Output,
                   Xmobar.Plugins.Monitors.Common.Parsers,
                   Xmobar.Plugins.Monitors.Common.Files,
                   Xmobar.Plugins.Monitors.CoreTemp,
                   Xmobar.Plugins.Monitors.CpuFreq,
                   Xmobar.Plugins.Monitors.Cpu,
                   Xmobar.Plugins.Monitors.Disk,
                   Xmobar.Plugins.Monitors.Mem,
                   Xmobar.Plugins.Monitors.MultiCoreTemp,
                   Xmobar.Plugins.Monitors.MultiCpu,
                   Xmobar.Plugins.Monitors.Net,
                   Xmobar.Plugins.Monitors.Swap,
                   Xmobar.Plugins.Monitors.Thermal,
                   Xmobar.Plugins.Monitors.ThermalZone,
                   Xmobar.Plugins.Monitors.Top,
                   Xmobar.Plugins.Monitors.Uptime,
                   Xmobar.Plugins.Monitors.Bright,
                   Xmobar.Plugins.Monitors.CatInt

    extra-libraries: Xrandr Xrender

    ghc-options: -funbox-strict-fields -Wall -fno-warn-unused-do-bind

    build-depends:
      base >= 4.9.1.0 && < 4.13,
      containers,
      regex-compat,
      process,
      old-locale,
      bytestring,
      directory,
      unix,
      time,
      filepath,
      transformers,
      X11 >= 1.6.1,
      mtl >= 2.1 && < 2.3,
      parsec == 3.1.*,
      parsec-numbers >= 0.1.0,
      stm >= 2.3 && < 2.6,
      extensible-exceptions == 0.1.*,
      async

    if impl(ghc < 8.0.2)
       -- Disable building with GHC before 8.0.2.
       -- Due to a cabal bug, do not use buildable: False,
       -- but instead give it an impossible constraint.
       -- See: https://github.com/haskell-infra/hackage-trustees/issues/165
       build-depends: unsupported-ghc-version > 1 && < 1

    if flag(with_threaded)
       -- -threaded is a workaround for 100% CPU busy loop
       -- (http://hackage.haskell.org/trac/ghc/ticket/4934).
       -- See also comments in https://github.com/jaor/xmobar/pull/36
       cpp-options: -DTHREADED_RUNTIME

    if flag(with_rtsopts)
       cpp-options: -DRTSOPTS

    if flag(with_xft) || flag(all_extensions)
       build-depends: utf8-string >= 0.3 && < 1.1, X11-xft >= 0.2 && < 0.4
       other-modules: Xmobar.X11.MinXft
       cpp-options: -DXFT

    if flag(with_utf8) || flag(all_extensions)
       build-depends: utf8-string >= 0.3 && < 1.1
       cpp-options: -DUTF8

    if flag(with_inotify) || flag(all_extensions)
       build-depends: hinotify >= 0.3 && < 0.5
       exposed-modules: Xmobar.Plugins.Mail, Xmobar.Plugins.MBox
       cpp-options: -DINOTIFY

    if flag(with_iwlib) || flag(all_extensions)
       extra-libraries: iw
       build-depends: iwlib >= 0.1.0 && < 0.2
       exposed-modules: Xmobar.Plugins.Monitors.Wireless
       cpp-options: -DIWLIB

    if flag(with_mpd) || flag(all_extensions)
       build-depends: libmpd >= 0.9.0.10
       exposed-modules: Xmobar.Plugins.Monitors.MPD
       cpp-options: -DLIBMPD

    if flag(with_alsa) || flag(all_extensions)
       build-depends: alsa-mixer >= 0.3 && < 0.4
       build-depends: alsa-core == 0.5.*,
                      process >= 1.4.3.0
       exposed-modules: Xmobar.Plugins.Monitors.Volume
                        Xmobar.Plugins.Monitors.Alsa
       cpp-options: -DALSA

    if flag(with_datezone) || flag(all_extensions)
       build-depends: timezone-olson == 0.1.*, timezone-series == 0.1.*
       exposed-modules: Xmobar.Plugins.DateZone
       cpp-options: -DDATEZONE

    if flag(with_mpris) || flag(all_extensions)
       build-depends: dbus >= 1
       exposed-modules: Xmobar.Plugins.Monitors.Mpris
       cpp-options: -DMPRIS

    if flag(with_dbus) || flag(all_extensions)
       build-depends: dbus >= 1
       other-modules: Xmobar.System.DBus
       cpp-options: -DDBUS

    if flag(with_xpm) || flag(all_extensions)
       extra-libraries: Xpm
       other-modules: Xmobar.X11.XPMFile
       cpp-options: -DXPM

    if flag(with_weather) || flag(all_extensions)
       exposed-modules: Xmobar.Plugins.Monitors.Weather
       cpp-options: -DWEATHER
       build-depends: http-conduit, http-types

    if flag(with_uvmeter)
       exposed-modules: Xmobar.Plugins.Monitors.UVMeter
       build-depends: http-conduit, http-types
       cpp-options: -DUVMETER

executable xmobar
    hs-source-dirs:     app
    main-is:            Main.hs
    build-depends:      base,
                        containers,
                        async,
                        X11,
                        directory,
                        filepath,
                        unix,
                        parsec,
                        xmobar

    ghc-options: -funbox-strict-fields -Wall -fno-warn-unused-do-bind

    if flag(with_rtsopts)
       ghc-options: -with-rtsopts=-V0

    if flag(with_threaded)
       -- -threaded is a workaround for 100% CPU busy loop
       -- (http://hackage.haskell.org/trac/ghc/ticket/4934).
       -- See also comments in https://github.com/jaor/xmobar/pull/36
       ghc-options: -threaded
       cpp-options: -DTHREADED_RUNTIME

test-suite XmobarTest
  type:           exitcode-stdio-1.0
  hs-source-dirs: src, test
  main-is:        Spec.hs
  build-depends: base,
                 containers,
                 regex-compat,
                 process,
                 old-locale,
                 bytestring,
                 directory,
                 unix,
                 time,
                 filepath,
                 transformers,
                 X11,
                 mtl,
                 parsec,
                 parsec-numbers,
                 stm,
                 async,
                 temporary,
                 hspec == 2.*,
                 xmobar

  other-modules: Xmobar.Plugins.Monitors.CommonSpec
                 Xmobar.Plugins.Monitors.Common
                 Xmobar.Plugins.Monitors.Common.Parsers
                 Xmobar.Plugins.Monitors.Common.Run
                 Xmobar.Plugins.Monitors.Common.Types
                 Xmobar.Plugins.Monitors.Common.Output
                 Xmobar.Plugins.Monitors.Common.Files
                 Xmobar.Run.Exec
                 Xmobar.System.Signal

  if flag(with_alsa) || flag(all_extensions)
      build-depends: alsa-mixer,
                     alsa-core,
                     process >= 1.4.3.0
      other-modules: Xmobar.Plugins.Monitors.Volume
                     Xmobar.Plugins.Monitors.Alsa
                     Xmobar.Plugins.Monitors.AlsaSpec

      cpp-options: -DALSA
